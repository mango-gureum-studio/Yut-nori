<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>윷 던지기</title>
<style>
  body { font-family: system-ui, sans-serif; text-align:center; padding-top:40px; }
  .wrap { display:flex; justify-content:center; gap:20px; margin-bottom:24px; }
  .yut { width:60px; height:220px; }
  .shake { animation: shake 0.08s linear infinite; }
  @keyframes shake {
    0% { transform: rotate(-6deg) translateY(0); }
    50% { transform: rotate(6deg) translateY(-6px); }
    100% { transform: rotate(-6deg) translateY(0); }
  }
  button { padding:10px 22px; font-size:16px; }
  .result { margin-top:18px; font-size:28px; font-weight:800; }
  .note { margin-top:8px; font-size:13px; opacity:0.75; }
</style>
</head>
<body>

<h1>윷 던지기</h1>

<div class="wrap">
  <img class="yut" src="yut_vertical_back_fuk.svg" alt="윷">
  <img class="yut" src="yut_vertical_back_fuk.svg" alt="윷">
  <img class="yut" src="yut_vertical_back_fuk.svg" alt="윷">
  <img class="yut" src="yut_vertical_back_fuk.svg" alt="윷">
</div>

<button onclick="throwYut()">던지기</button>
<div class="result" id="result">—</div>

<script>
const BACK   = "yut_vertical_back_fuk.svg";        // 등면(복)
const BELLY  = "yut_vertical_front_plain.svg";     // 앞면(배)
const BACKDO = "yut_vertical_front_do.svg";        // 앞면 + 점 (빽도)

// 원하는 확률: 빽도 1/40 (= 0.025) + 나머지는 개 > 도 > 걸 > 윷 > 모
const P_BACKDO = 1 / 40;

// 남은 0.975(= 39/40)을 아래 비율로 배분 (원하면 숫자만 바꾸면 됨)
const OUTCOMES = ["개 (Gae)", "도 (Do)", "걸 (Geol)", "윷 (Yut)", "모 (Mo)"];
const WEIGHTS  = [0.30,       0.25,      0.20,        0.15,      0.075]; // 합 = 0.975

// 결과에 따른 "배(앞면) 개수" (전통 윷 규칙 기준)
const bellyCountByOutcome = {
  "모 (Mo)"   : 0,
  "도 (Do)"   : 1,
  "개 (Gae)"  : 2,
  "걸 (Geol)" : 3,
  "윷 (Yut)"  : 4
};

let audioCtx = null;

function playSound() {
  if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  audioCtx.resume(); // 모바일/브라우저 자동재생 막힘 해제

  const now = audioCtx.currentTime;
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();

  osc.type = "triangle";
  osc.frequency.setValueAtTime(260, now);
  gain.gain.setValueAtTime(0.3, now);
  gain.gain.exponentialRampToValueAtTime(0.001, now + 0.15);

  osc.connect(gain);
  gain.connect(audioCtx.destination);

  osc.start(now);
  osc.stop(now + 0.15);
}

function weightedPick(items, weights) {
  const total = weights.reduce((a,b) => a + b, 0);
  let r = Math.random() * total;
  for (let i = 0; i < items.length; i++) {
    r -= weights[i];
    if (r <= 0) return items[i];
  }
  return items[items.length - 1];
}

function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

function throwYut() {
  const yuts = Array.from(document.querySelectorAll(".yut"));
  yuts.forEach(y => y.classList.add("shake"));
  document.getElementById("result").textContent = "…";

  playSound();

  setTimeout(() => {
   // 1) 1/40 확률로 빽도: 앞면 1개(점), 나머지 3개 등면
if (Math.random() < P_BACKDO) {
  const pick = Math.floor(Math.random() * yuts.length);

 yuts.forEach((y, i) => {
  y.src = (i === pick) ? BACKDO : BACK;
  y.classList.remove("shake");
});

  document.getElementById("result").textContent = "빽도 (Back Do)";
  return;
}

    // 2) 나머지는 가중치로 결과 결정
    const outcome = weightedPick(OUTCOMES, WEIGHTS);
    const bellyCount = bellyCountByOutcome[outcome];

    // bellyCount만큼 랜덤으로 앞면(BELLY), 나머지는 등면(BACK)
    const idxs = shuffle([0,1,2,3]);
    const bellySet = new Set(idxs.slice(0, bellyCount));

    yuts.forEach((y, i) => {
      y.src = bellySet.has(i) ? BELLY : BACK;
      y.classList.remove("shake");
    });

    document.getElementById("result").textContent = outcome;
  }, 800);
}
</script>

</body>
</html>
