<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ìœ· ë˜ì§€ê¸°</title>

<style>
  body { font-family: system-ui, sans-serif; text-align:center; padding-top:40px; }
  .wrap { display:flex; justify-content:center; gap:20px; margin-bottom:24px; }
  .yut {
  width: 20vw;
  max-width: 100px;
  height: auto;
}

  .shake { animation: shake 0.08s linear infinite; }
  @keyframes shake {
    0% { transform: rotate(-6deg) translateY(0); }
    50% { transform: rotate(6deg) translateY(-6px); }
    100% { transform: rotate(-6deg) translateY(0); }
  }
  button {
  font-size: 5vw;
  padding: 14px 28px;
  max-font-size: 22px;
}

.result {
  font-size: 8vw;
  max-font-size: 40px;
}

  .note { margin-top:8px; font-size:13px; opacity:0.75; }
@media (max-width: 600px) {
  body {
    padding-top: 24px;
  }

  h1 {
    font-size: 28px;
  }

  .wrap {
    gap: 12px;
  }

  .yut {
    width: 90px;      /* ğŸ”¥ í•µì‹¬ */
    height: auto;     /* ë¹„ìœ¨ ìœ ì§€ */
  }

  button {
    font-size: 20px;
    padding: 14px 28px;
  }

  .result {
    font-size: 36px;
  }
}

</style>
</head>
<body>

<h1>ìœ· ë˜ì§€ê¸°</h1>

<div class="wrap">
  <img class="yut" src="yut_vertical_back_fuk.svg" alt="ìœ·">
  <img class="yut" src="yut_vertical_back_fuk.svg" alt="ìœ·">
  <img class="yut" src="yut_vertical_back_fuk.svg" alt="ìœ·">
  <img class="yut" src="yut_vertical_back_fuk.svg" alt="ìœ·">
</div>

<button onclick="throwYut()">ë˜ì§€ê¸°</button>
<div class="result" id="result">â€”</div>

<script>
const BACK   = "yut_vertical_back_fuk.svg";        // ë“±ë©´(ë³µ)
const BELLY  = "yut_vertical_front_plain.svg";     // ì•ë©´(ë°°)
const BACKDO = "yut_vertical_front_do.svg";        // ì•ë©´ + ì  (ë¹½ë„)

// ì›í•˜ëŠ” í™•ë¥ : ë¹½ë„ 1/40 (= 0.025) + ë‚˜ë¨¸ì§€ëŠ” ê°œ > ë„ > ê±¸ > ìœ· > ëª¨
const P_BACKDO = 1 / 40;

// ë‚¨ì€ 0.975(= 39/40)ì„ ì•„ë˜ ë¹„ìœ¨ë¡œ ë°°ë¶„ (ì›í•˜ë©´ ìˆ«ìë§Œ ë°”ê¾¸ë©´ ë¨)
const OUTCOMES = ["ê°œ (Gae)", "ë„ (Do)", "ê±¸ (Geol)", "ìœ· (Yut)", "ëª¨ (Mo)"];
const WEIGHTS  = [0.30,       0.25,      0.20,        0.15,      0.075]; // í•© = 0.975

// ê²°ê³¼ì— ë”°ë¥¸ "ë°°(ì•ë©´) ê°œìˆ˜" (ì „í†µ ìœ· ê·œì¹™ ê¸°ì¤€)
const bellyCountByOutcome = {
  "ëª¨ (Mo)"   : 0,
  "ë„ (Do)"   : 1,
  "ê°œ (Gae)"  : 2,
  "ê±¸ (Geol)" : 3,
  "ìœ· (Yut)"  : 4
};

let audioCtx = null;

function playSound() {
  if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  audioCtx.resume(); // ëª¨ë°”ì¼/ë¸Œë¼ìš°ì € ìë™ì¬ìƒ ë§‰í˜ í•´ì œ

  const now = audioCtx.currentTime;
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();

  osc.type = "triangle";
  osc.frequency.setValueAtTime(260, now);
  gain.gain.setValueAtTime(0.3, now);
  gain.gain.exponentialRampToValueAtTime(0.001, now + 0.15);

  osc.connect(gain);
  gain.connect(audioCtx.destination);

  osc.start(now);
  osc.stop(now + 0.15);
}

function weightedPick(items, weights) {
  const total = weights.reduce((a,b) => a + b, 0);
  let r = Math.random() * total;
  for (let i = 0; i < items.length; i++) {
    r -= weights[i];
    if (r <= 0) return items[i];
  }
  return items[items.length - 1];
}

function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

function throwYut() {
  const yuts = Array.from(document.querySelectorAll(".yut"));
  yuts.forEach(y => y.classList.add("shake"));
  document.getElementById("result").textContent = "â€¦";

  playSound();

  setTimeout(() => {
   // 1) 1/40 í™•ë¥ ë¡œ ë¹½ë„: ì•ë©´ 1ê°œ(ì ), ë‚˜ë¨¸ì§€ 3ê°œ ë“±ë©´
if (Math.random() < P_BACKDO) {
  const pick = Math.floor(Math.random() * yuts.length);

 yuts.forEach((y, i) => {
  y.src = (i === pick) ? BACKDO : BACK;
  y.classList.remove("shake");
});

  document.getElementById("result").textContent = "ë¹½ë„ (Back Do)";
  return;
}

    // 2) ë‚˜ë¨¸ì§€ëŠ” ê°€ì¤‘ì¹˜ë¡œ ê²°ê³¼ ê²°ì •
    const outcome = weightedPick(OUTCOMES, WEIGHTS);
    const bellyCount = bellyCountByOutcome[outcome];

    // bellyCountë§Œí¼ ëœë¤ìœ¼ë¡œ ì•ë©´(BELLY), ë‚˜ë¨¸ì§€ëŠ” ë“±ë©´(BACK)
    const idxs = shuffle([0,1,2,3]);
    const bellySet = new Set(idxs.slice(0, bellyCount));

    yuts.forEach((y, i) => {
      y.src = bellySet.has(i) ? BELLY : BACK;
      y.classList.remove("shake");
    });

    document.getElementById("result").textContent = outcome;
  }, 800);
}
</script>

</body>
</html>
